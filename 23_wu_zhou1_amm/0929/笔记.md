太好了，我们进入**第 4 节：生成元计算与不等式推导**。这节把“区间内连续演化”和“触发瞬间跳变”两部分**严格写清**，并把**扩展耗散性供给率**合进去，形成下一节可直接转成 LMI 的不等式骨架。为避免符号爆炸，我们采用**模块化拼装**：先定义闭环矩阵，再逐步代入。

---

# 第 4 节 生成元与不等式

## 4.1 闭环增广动力学的块表示

回忆 §2.4 的增广状态
[
\xi=\mathrm{col}(x,\tilde x,\tilde w,e_x,e_w)\in\mathbb R^{n_\xi},\quad
e=\mathrm{col}(e_x,e_w)\in\mathbb R^{n_e},\quad \tau=t-t_k.
]

### 4.1.1 区间内（(t\in[t*k,t*{k+1}))）

控制律 (u=K*i(x+e_x)+K*{w,i}(\hat w+e_w))；(\hat w=\tilde w+w)。按 §2.4 的逐块计算，可将区间内动力学统一写成
[
\boxed{\ \dot\xi ;=; F_i,\xi ;+; G_i,e ;+; H_i,d,\qquad
\dot e ;=; F^{(e)}_i,\xi ;+; G^{(e)}_i,e ;+; H^{(e)}_i,d,\ }
\tag{4.1}
]
其中外部/有界信号堆叠为
[
d:=\mathrm{col}\big(w,\dot w\big),\qquad | \dot w | \le \rho.
\tag{4.2}
]
**说明：**

- (F_i,G_i,H_i,F^{(e)}\_i,G^{(e)}\_i,H^{(e)}_i) 是由 ((A_i,B_i,E_i,C_i)) 与 ((K_i,K_{w,i},L_i,K_i^{\rm obs},\alpha_i)) 唯一确定的常矩阵；
- 显式表达（若需要落地实现）：
  [
  \begin{aligned}
  \dot x&=(A_i+B_iK_i)x + B_iK_{w,i}\tilde w + B_iK_i e_x + B_iK_{w,i} e_w + E_i w,\
  \dot{\tilde x}&=(A_i-L_iC_i)\tilde x + E_i\tilde w - E_i w,\
  \dot{\tilde w}&=-\alpha_i \tilde w + K_i^{\rm obs}C_i\tilde x - \dot w,\
  \dot e_x&=-\dot x,\qquad \dot e_w=-\dot{\hat w}= \alpha_i \tilde w - K_i^{\rm obs}C_i\tilde x + \dot w.
  \end{aligned}
  ]
  将右端按 (\xi,e,d) 线性分组即可读出 (4.1) 的各块矩阵。

### 4.1.2 性能输出

[
z = C*{z,i} x + D*{z,i} u
= \underbrace{\big(C*{z,i}+D*{z,i}K*i\big)}*{C*{x,i}} x
;+; \underbrace{D*{z,i}K*{w,i}}*{C*{\hat w,i}} \hat w
;+; \underbrace{D*{z,i}[K_i\ \ 0]}_{C_{e,i}} e.
\tag{4.3}
]
又 (\hat w=\tilde w+w)，故
[
z = C_\xi^i,\xi ;+; C_e^i,e ;+; C_d^i, d,
\quad
C_\xi^i:=\begin{bmatrix} C_{x,i} & 0 & C_{\hat w,i} & 0 & 0 \end{bmatrix},
C_e^i:=C_{e,i},
C_d^i:=\begin{bmatrix} C_{\hat w,i} & 0\end{bmatrix}.
\tag{4.4}
]

---

## 4.2 LKF 的导数与马尔科夫生成元

回忆 §3 的 LKF：
[
V_i(\xi,\tau)=\xi^\top P_i\xi + e^\top R_i e + 2,\xi^\top N_i e + \tau,e^\top W_i e + \int_{t_k}^t \zeta^\top Q_i \zeta, d\theta,
\tag{3.1 再引}
]
其中 (\zeta=\mathrm{col}(x,\hat w))。区间内导数（§3.2）为
[
\dot V_i
= 2\xi^\top P_i \dot\xi + 2,\dot\xi^\top N_i e + 2,\xi^\top N_i \dot e

- 2 e^\top R_i \dot e
- \tau,\frac{d}{dt}(e^\top W_i e) + e^\top W_i e
- \zeta^\top Q*i \zeta.
  \tag{4.5}
  ]
  将 (4.1) 代入，得到关于 ((\xi,e,d)) 的**二次型**：
  [
  \dot V_i
  = \begin{bmatrix}\xi\ e\ d\end{bmatrix}^{!\top}
  \underbrace{\begin{bmatrix}
  \star & \star & \star\
  \star & \star & \star\
  \star & \star & \star
  \end{bmatrix}}*{\mathcal M^{\rm flow}\_i}
  \begin{bmatrix}\xi\ e\ d\end{bmatrix}
  \ +\ \zeta^\top Q_i \zeta.
  \tag{4.6}
  ]
  其中 (\mathcal M^{\rm flow}\_i) 的各块由 ((P_i,R_i,N_i,W_i)) 与 ((F_i,G_i,H_i,F_i^{(e)},G_i^{(e)},H_i^{(e)})) 线性组合给出（完全线性于待设计变量）。

**积分项上界化**（不跳步）：
记区间平均 (\bar\zeta:=\frac{1}{\tau}\int\_{t_k}^t \zeta(\theta),d\theta)（当 (\tau=0) 取 (\bar\zeta=0)）。

- **Jensen 不等式**：(\displaystyle \int\_{t_k}^t \zeta^\top Q_i \zeta , d\theta \ \ge\ \tau, \bar\zeta^\top Q_i \bar\zeta.)
- **Wirtinger/PII 增强**：引入自由矩阵 (\Xi*i) 可得更紧上界
  [
  \int*{t*k}^t \zeta^\top Q_i \zeta , d\theta
  \ \ge\
  \begin{bmatrix}\zeta(t)\ \bar\zeta \end{bmatrix}^{!\top}
  \underbrace{\begin{bmatrix} \Omega*{11,i} & \Omega*{12,i}\ \Omega*{12,i}^\top & \Omega\_{22,i}\end{bmatrix}}_{\Omega_i(Q_i)}
  \begin{bmatrix}\zeta(t)\ \bar\zeta \end{bmatrix},
  \tag{4.7}
  ]
  其中 (\Omega_i(Q_i)) 线性依赖 (Q_i) 与 (\Xi_i)。实践里我们选用 Wirtinger+自由权形式（更不保守）；(4.7) 右端可进一步通过引入与 ((\xi,e)) 线性相关的(\zeta(t),\bar\zeta) 表达，最终变成对 ((\xi,e)) 的二次型下界：
  [
  \int_{t_k}^{t}\zeta^\top Q_i\zeta
  \ \ge
  \begin{bmatrix}\xi\ e\end{bmatrix}^{!\top}
  \Theta_i(Q_i,\Xi_i)
  \begin{bmatrix}\xi\ e\end{bmatrix}.
  \tag{4.8}
  ]

**马尔科夫生成元**（区间内）：
[
\boxed{\ \mathcal L V(\xi,e,i)
= \dot V_i(\xi,e,\tau)
\ +\ \sum_{j\ne i} q_{ij}\big(V_j(\xi,e,\tau)-V_i(\xi,e,\tau)\big).\ }
\tag{4.9}
]
注意 (V*j-V_i) 只改变 (P,R,N,W,Q) 的索引，因此
[
V_j - V_i = \begin{bmatrix}\xi\ e\end{bmatrix}^{!\top}
\underbrace{\begin{bmatrix}
\Delta P*{ji} & \Delta N*{ji}[2pt]
\Delta N*{ji}^\top & \Delta R*{ji} + \tau,\Delta W*{ji}
\end{bmatrix}}_{=: \ \Delta_{ji}(\tau)}
\begin{bmatrix}\xi\ e\end{bmatrix},
\quad \Delta P\_{ji}:=P_j-P_i\ (\text{其余类同}).
\tag{4.10}
]

---

## 4.3 供给率嵌入与区间内主不等式

扩展耗散性供给率：
[
s_i(z,w)=\begin{bmatrix}z\ w\end{bmatrix}^{!\top}\Pi_i\begin{bmatrix}z\ w\end{bmatrix}
= \begin{bmatrix}\xi\ e\ d\end{bmatrix}^{!\top}
\underbrace{\begin{bmatrix}
{C_\xi^i}^\top & {C_e^i}^\top & {C_d^i}^\top\
\end{bmatrix}\Pi_i
\begin{bmatrix}
C_\xi^i & C_e^i & C_d^i
\end{bmatrix}}_{=: \ \mathcal S_i(\Pi_i)}
\begin{bmatrix}\xi\ e\ d\end{bmatrix}.
\tag{4.11}
]

**区间内期望衰减要求**（严格写法）：
[
\mathbb E\big[\mathcal L V(\xi,e,\theta(t)) + s_{\theta(t)}(z,w) \big]\ \le\ 0.
\tag{4.12}
]
展开 (4.9)(4.11)，再结合 (4.6)(4.8)(4.10) 可得对任意 ((\xi,e,d))：
[
\begin{bmatrix}\xi\ e\ d\end{bmatrix}^{!\top}
\bigg(
\underbrace{\mathcal M^{\rm flow}*i + \mathcal S_i(\Pi_i)}*{\text{连续导数 + 供给率}}
\ +\
\underbrace{\begin{bmatrix}I\ 0\ 0\end{bmatrix}!\Theta_i!\begin{bmatrix}I & 0 & 0\end{bmatrix}}*{\text{积分项下界}}
\ +\
\underbrace{\sum*{j\ne i}q_{ij}
\begin{bmatrix}I\ 0\ 0\end{bmatrix}^{!\top}
!\Delta_{ji}(\tau)!
\begin{bmatrix}I\ 0\ 0\end{bmatrix}}_{\text{模式跳变差分}}
\bigg)
\begin{bmatrix}\xi\ e\ d\end{bmatrix}
\ \le\ 0.
\tag{4.13}
]

> 评注：
>
> - (4.13) 是**区间内主不等式**。它线性依赖于待设计变量 ((P*i,R_i,N_i,W_i,Q_i,K_i,K*{w,i},L_i,K_i^{\rm obs},\alpha_i,\Pi_i))。
> - (\tau) 显现在 (\Delta*{ji}(\tau)) 中；由于 (\tau\in[0,\infty)) 但受触发律与 (h*{\min}) 限制，常见做法是：
>   (i) **去 (\tau) 保守化**：丢弃 (\tau,\Delta W*{ji})（取 (\Delta W*{ji}=0) 或用 (\tau\ge0) 的负半定项处理）；
>   (ii) 或者设上界 (\tau\le h*{\max})（若系统另有采样上界），用区间多面体技巧分别在 (\tau=0,h*{\max}) 处保证。

---

## 4.4 触发瞬间不等式与蕴含处理（S-程序）

触发瞬间由 §2.3 的判据：
[
g_i(e,x,\hat w):=
\begin{bmatrix}e\ \end{bmatrix}^{!\top}!\Phi_i!\begin{bmatrix}e\end{bmatrix}

---

\begin{bmatrix}x\ \hat w\end{bmatrix}^{!\top}!\Psi*i!\begin{bmatrix}x\ \hat w\end{bmatrix}
\ \ge\ 0,\quad \tau\ge h*{\min}.
\tag{2.4 再引}
]
同时重置使
[
\Delta V := V_{i^+}(\xi^+,0)-V_{i^-}(\xi,\tau)
= \xi^\top!\big(\mathcal J_i^\top P_{i^+}\mathcal J_i - P_{i^-}\big)\xi
\ -\ e^\top!\big(R_{i^-}+\tau W_{i^-}\big)e
\ -\ 2,\xi^\top N_{i^-} e.
\tag{4.14}
]
我们要求“**触发不增能量**”或更强的“**触发带来衰减**”，即
[
g_i\ge 0\ \Longrightarrow\ \Delta V \ \le\ 0.
\tag{4.15}
]
用 **S-程序** 将蕴含转为充分条件：存在标量 (\sigma*i\ge 0)，使
[
\Delta V\ +\ \sigma_i, g_i \ \le\ 0.
\tag{4.16}
]
把 (x,\hat w) 换成 ((\xi,e)) 的线性组合（注意 (\hat w=\tilde w+w)，但触发瞬间不重置 (w)，我们在跳变条件里**不显式出现 (w)**，即用 ((x,\tilde w)) 表示 (\hat w) 的依赖，属于保守但可行的处理），则 (4.16) 可写成：
[
\begin{bmatrix}\xi\ e\end{bmatrix}^{!\top}
\Big(
\underbrace{\begin{bmatrix}
\mathcal J_i^\top P*{i^+}\mathcal J*i - P*{i^-} & -N*{i^-}[2pt]
-N*{i^-}^\top & -R*{i^-} - \tau W*{i^-}
\end{bmatrix}}\_{\mathcal M^{\rm jump}\_i(\tau)}
\ +\
\sigma_i,\underbrace{\begin{bmatrix}

- \widehat\Psi*{i} & 0\ 0 & \Phi_i
  \end{bmatrix}}*{\mathcal G_i}
  \Big)
  \begin{bmatrix}\xi\ e\end{bmatrix}
  \ \le\ 0.
  \tag{4.17}
  ]
  其中 (\widehat\Psi_i) 是把 (\Psi_i) 作用在 ((x,\hat w)) 并用 ((\xi,e)) 变量替换后的等效矩阵（线性可得，维度与 (\xi) 匹配）。

> 评注与细节：
>
> - 若希望**不依赖 (\tau)**，可如 §4.3 的处理那样去掉 (\tau W*{i^-}) 或设 (\tau\le h*{\max}) 做两端检查。
> - 若触发时允许“强衰减”，可在 (4.16) 右侧加 (-\epsilon|(\xi,e)|^2) 强化；这仍保持线性。

---

## 4.5 汇总：可转 LMI 的两类矩阵不等式

把区间内与跳变两部分整理如下，供下一节直接施行 Schur 补与变量替换（如 (Y_i=K_iP) 等）：

### (I) 区间内（对所有 (i)）

存在矩阵 ((P*i\succ0,R_i\succeq0,N_i,W_i\succeq0,Q_i\succeq0))、自由矩阵（Wirtinger/PII 中的 (\Xi_i)）、控制/观测增益 ((K_i,K*{w,i},L*i,K_i^{\rm obs},\alpha_i>0))，使
[
\boxed{\
\mathcal H^{\rm flow}*i(\text{vars})
:=
\mathcal M^{\rm flow}*i
\ +\ \mathcal S_i(\Pi_i)
\ +\ \begin{bmatrix}I\0\0\end{bmatrix}!\Theta_i!\begin{bmatrix}I&0&0\end{bmatrix}
\ +\ \sum*{j\ne i} q*{ij}\begin{bmatrix}I\0\0\end{bmatrix}^{!\top}!\Delta*{ji}(\tau)!\begin{bmatrix}I\0\0\end{bmatrix}
\ \preceq\ 0\ .
}
\tag{4.18}
]

### (II) 触发瞬间（对所有 (i)）

存在 (\sigma_i\ge 0) 使
[
\boxed{\
\mathcal H^{\rm jump}_i(\text{vars})
:=
\mathcal M^{\rm jump}_i(\tau)
\ +\ \sigma_i,\mathcal G_i
\ \preceq\ 0\ .
}
\tag{4.19}
]

> 实务建议：若不设采样上界 (h*{\max})，(4.18)(4.19) 中出现 (\tau) 的项可**去掉 (\tau) 相关负半定块**以获得保守但简洁的 LMI；或在 (\tau\in{0,h*{\max}}) 两端检查（凸组合保证中间成立）。

---

## 4.6 本节小结（检查点）

1. 我们把 LKF 导数写成关于 ((\xi,e,d)) 的**二次型**，并用 Jensen/Wirtinger/PII 给出积分项**可线性化的下界**（(4.8)）。
2. 马尔科夫生成元导致的**模式差分项**以 (\Delta\_{ji}) 的形式线性进入（(4.10)）。
3. 供给率 (s_i(z,w)) 以 (\mathcal S_i(\Pi_i)) 的二次型矩阵进入（(4.11)）。
4. 触发瞬间的**蕴含条件**用 S-程序处理为 (4.17)，仍是线性矩阵不等式。
5. 区间内与跳变两类条件分别汇总为 (4.18)(4.19)，这就是**下一节做 LMI 判据**的起点。

---

如果这一节你没疑问，我就进入**第 5 节：LMI 判据与增益合成**——我们会把 (4.18)(4.19) 通过**变量替换**（如 (Y*i=K_i P*{x,i})、(\hat Y*{w,i}=K*{w,i} P*{x,i})、(Z_i=L_i P*{x,i}) 等）线性化耦合项，给出**一组可直接求解的 LMI**，并说明如何从解恢复 (K*i,K*{w,i},L_i) 与触发矩阵 (\Phi_i,\Psi_i)。
